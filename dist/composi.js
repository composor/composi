!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.composi={})}(this,function(e){"use strict";var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),x=0,S=3,s="http://www.w3.org/1999/xlink",a="http://www.w3.org/2000/svg",r={},i=[];function w(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(function(e){return JSON.parse(JSON.stringify(e))}).reduce(function(e,t){return Object.assign({},e,t)})}var u=function e(){o(this,e),this.message="Cannot insert Fragment tag directly into DOM.",this.toString=function(){return this.message}};function t(){var n=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}function f(e){return"number"==typeof e&&isNaN(e)?"NaN":new RegExp("\\[object (.*)]").exec(toString.call(e))[1]}function h(e,t,n,o,r,i){return{type:e,props:t,children:n,element:o,key:r,flag:i}}function d(e,t){return h(e,r,i,t,null,S)}function l(e){return h(e.nodeName.toLowerCase(),r,i.map.call(e.childNodes,p),e,null,x)}function p(e){return 3===e.nodeType?d(e.nodeValue,e):l(e)}function m(e){return e.currentTarget.events[e.type](e)}function k(e){return null==e?null:e.key}function N(e,t,n,o,r){if(n!==o)if("style"===t&&"Object"===f(o))for(var i in w(n,o)){var u=null==o||null==o[i]?"":o[i];"-"===i[0]?e[t].setProperty(i,u):e[t][i]=u}else if("key"!==t)if("className"===t&&(t="class"),"o"===t[0]&&"n"===t[1])e.events||(e.events={}),t=t.slice(2).toLowerCase(),n||(n=e.events[t]),null==(e.events[t]=o)?e.removeEventListener(t,m):null==n&&e.addEventListener(t,m);else{var l=null==o||!1===o||"no"===o||"off"===o;t in e&&"list"!==t&&"type"!==t&&"draggable"!==t&&"spellcheck"!==t&&"translate"!==t&&!r?(e[t]=null==o?"":o,l&&e.removeAttribute(t)):"xlink-href"===t||"xlinkHref"===t?(e.setAttributeNS(s,"href",o),e.setAttribute("href",o)):l?e.removeAttribute(t):e.setAttribute(t,o)}}function O(e,t,n){var o=void 0;o=e.flag===S?document.createTextNode(e.type):(n=n||"svg"===e.type)?document.createElementNS(a,e.type):document.createElement(e.type);var r=e.props;r.onmount&&t.push(function(){r.onmount(o)});for(var i=0,u=e.children.length;i<u;i++)o.appendChild(O(e.children[i],t,n));for(var l in r)N(o,l,null,r[l],n);return e.element=o}function M(e,t){function n(){e&&e.nodeType&&e.removeChild(function e(t){for(var n=0,o=t.children.length;n<o;n++)e(t.children[n]);return t.element}(t))}var o=t.props&&t.props.onunmount;null!=o?o(n,t.element):n()}function j(e,t,n,o,r,i){if(o===n);else if(null!=n&&n.flag===S&&o.flag===S)n.type!==o.type&&(t.nodeValue=o.type);else if(null==n||n.type!==o.type){var u=e.insertBefore(O(o,r,i),t);null!=n&&M(e,n),t=u}else{!function(e,t,n,o,r,i){for(var u in w(t,n))("value"===u||"checked"===u?e[u]:t[u])!==n[u]&&N(e,u,t[u],n[u],r);var l=i?n.onmount:n.onupdate;null!=l&&o.push(function(){l(e,t,n)})}(t,n.props,o.props,r,i=i||"svg"===o.type,n.flag===x);for(var l=void 0,s=void 0,a=void 0,c=n.children,f=0,h=c.length-1,d=void 0,p=o.children,m=0,y=p.length-1;m<=y&&f<=h&&(a=k(c[f]),d=k(p[m]),null!=a&&a===d);)j(t,c[f].element,c[f],p[m],r,i),f++,m++;for(;m<=y&&f<=h&&(a=k(c[h]),d=k(p[y]),null!=a&&a===d);)j(t,c[h].element,c[h],p[y],r,i),h--,y--;if(h<f)for(;m<=y;)t.insertBefore(O(p[m++],r,i),(s=c[f])&&s.element);else if(y<m)for(;f<=h;)M(t,c[f++]);else{for(var v=function(e,t,n){for(var o={},r=void 0,i=void 0;t<=n;t++)null!=(r=(i=e[t]).key)&&(o[r]=i);return o}(c,f,h),g={};m<=y;)a=k(s=c[f]),d=k(p[m]),g[a]||null!=d&&d===k(c[f+1])?(null==a&&M(t,s),f++):null==d||n.flag===x?(null==a&&(j(t,s&&s.element,s,p[m],r,i),m++),f++):(a===d?(j(t,s.element,s,p[m],r,i),g[d]=!0,f++):null!=(l=v[d])?(j(t,t.insertBefore(l.element,s&&s.element),l,p[m],r,i),g[d]=!0):j(t,s&&s.element,null,p[m],r,i),m++);for(;f<=h;)null==k(s=c[f++])&&M(t,s);for(var b in v)null==g[b]&&M(t,v[b])}}return o.element=t,o}function y(e,t,n){"string"==typeof n&&(n=document.querySelector(n));var o=[];if(j(n,n.children[0],t,e,o),e!==t)for(;0<o.length;)o.pop()();return e}function v(e,t,n){"string"==typeof t&&(t=document.querySelector(t)),t||(t=document.body);var o=[];if(Array.isArray(e))throw new u;n?("string"==typeof n&&(n=document.querySelector(n)),y(e,l(n),t)):e=j(t,null,null,e,o);for(e.element.isMounted=!0;0<o.length;)o.pop()();return e}var g=(new Date).getTime().toString(16),b=function(){function t(e){o(this,t),e||(e={}),this.props=e,this.selector=e.container||"body",e.render&&(this.render=e.render),e.state&&(this.state=e.state),this.selector&&(this.container=document.querySelector(this.selector)),this.currentVNode=null,this.componentShouldUpdate=!0,this.isMounted=!1,this.element=null,this.hydrate=e.hydrate||null,e.componentWillMount&&(this.componentWillMount=e.componentWillMount),e.componentDidMount&&(this.componentDidMount=e.componentDidMount),e.componentWillUpdate&&(this.componentWillUpdate=e.componentWillUpdate),e.componentDidUpdate&&(this.componentDidUpdate=e.componentDidUpdate),e.componentWillUnmount&&(this.componentWillUnmount=e.componentWillUnmount)}return n(t,[{key:"noop",value:function(){}},{key:"componentWillMount",value:function(e){e&&"function"==typeof e&&e.call(e,this)}},{key:"componentDidMount",value:function(){this.noop()}},{key:"componentWillUpdate",value:function(e){e&&"function"==typeof e&&e.call(e,this)}},{key:"componentDidUpdate",value:function(){this.noop()}},{key:"componentWillUnmount",value:function(e){e&&"function"==typeof e&&e.call(e,this)}},{key:"render",value:function(e){return e}},{key:"setState",value:function(e){if("function"==typeof e){var t=void 0;t="Object"===f(this.state)?w(r,this.state):Array.isArray(this.state)?i.concat(i,this.state):this.state;var n=e.call(this,t);n&&(this.state=n)}else if("Object"===f(this.state)&&"Object"===f(e)){var o=w(this.state,e);this.state=o}else this.state=e}},{key:"update",value:function(e){if(this.render&&(this.componentShouldUpdate||!this.isMounted)){var t=this.state;!0!==e&&e&&(t=e),this.container&&"string"==typeof this.container&&(this.selector=this.container,this.container=document.querySelector(this.container)),this.hydrate&&!this.isMounted&&("string"==typeof this.hydrate&&(this.hydrate=document.querySelector(this.hydrate)),this.currentVNode=l(this.hydrate));var n=this.render(t),o=this;if(!this.isMounted)return this.currentVNode?(this.oldVNode=n,this.currentVNode=y(n,this.currentVNode,this.container),this.element=this.currentVNode.element,this.isMounted=!0,this.componentDidMount()):this.componentWillMount(function(){o.oldVNode=n,o.currentVNode=v(n,o.container),o.element=o.currentVNode.element,o.isMounted=!0,o.componentDidMount()}),void(this.container&&1===this.container.nodeType||console.error("The container for this class component is not a valid DOM node. Check the selector provided for the class to make sure it is a valid CSS selector and that the container exists in the DOM. You might be targeting a nonexistent node."));(function(e,t){if("Object"===f(e)||"Object"===f(t))return JSON.stringify(e)===JSON.stringify(t)})(n,this.oldVNode)||this.componentWillUpdate(function(){o.oldVNode=o.render(t),o.currentVNode=y(n,o.currentVNode,o.container),o.element=o.currentVNode.element,o.isMounted=!0,o.componentDidUpdate()})}}},{key:"unmount",value:function(){if(this.element){var t=this;this.componentWillUnmount(function(){for(var e in t.container.removeChild(t.element),t)delete t[e];t.__proto__=null})}}},{key:"state",get:function(){return this[g]},set:function(e){var t=this;this[g]=e,setTimeout(function(){return t.update()},1e3/60)}}]),t}(),D=function(){function e(){o(this,e),this.events={}}return n(e,[{key:"watch",value:function(e,t){return this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t)}},{key:"dispatch",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.events.hasOwnProperty(e)?this.events[e].map(function(e){return e(t)}):[]}},{key:"unwatch",value:function(e){delete this.events[e]}}]),e}(),U=t(),V=function(){function t(e){o(this,t),this[U]=void 0,this.observer=new D,this.state=e.state}return n(t,[{key:"dispatch",value:function(e,t){this.observer.dispatch(e,t)}},{key:"watch",value:function(e,t){this.observer.watch(e,t)}},{key:"setState",value:function(e){if("function"==typeof e){var t;t=w(r,this.state);var n=e.call(this,t);n&&(this.state=n)}else if("Object"===f(this.state)&&"Object"===f(e)){var o=w(this.state,e);this.state=o}}},{key:"state",get:function(){return this[U]},set:function(e){this[U]=e,this.dispatch("dataStoreStateChanged",this.state)}}]),t}(),W=function(e){function n(e){o(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.dataStore=e.dataStore,e.dataStore instanceof V&&(e.dataStore.watch("dataStoreStateChanged",function(){return t.update(t.dataStore.state)}),t.update(t.dataStore.state)),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,b),n}();e.h=function(e,t){for(var n=void 0,o=[],r=[],i=arguments.length,u=Array(2<i?i-2:0),l=2;l<i;l++)u[l-2]=arguments[l];for(var s=u.length,a=(t=t||{}).key;0<s--;)o.push(u[s]);for(null!=t.children&&(o.length<=0&&o.push(t.children),delete t.children);0<o.length;)if(Array.isArray(n=o.pop()))for(s=n.length;0<s--;)o.push(n[s]);else!1===n||!0===n||null==n||r.push("object"===(void 0===n?"undefined":c(n))?n:d(n));return delete t.key,"function"==typeof e?e(t,t.children=r):h(e,t,r,null,a,1)},e.mount=v,e.unmount=function(e){function t(){e.element.parentNode.removeChild(e.element),e.element=null}e.props.onunmount?e.props.onunmount(t,e.element):t()},e.render=function(e,t,n){return y(e,t,n)},e.Component=b,e.Fragment=function(e,t){return t},e.DataStore=V,e.DataStoreComponent=W,e.Observer=D,e.uuid=t,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=composi.js.map
