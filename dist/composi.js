!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.composi={})}(this,function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=(function(){function e(e){this.value=e}function t(t){var n,o;function r(n,o){try{var u=t[n](o),l=u.value;l instanceof e?Promise.resolve(l.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(u.done?"return":"normal",u.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?r(n.key,n.arg):o=null}this._invoke=function(e,t){return new Promise(function(i,u){var l={key:e,arg:t,resolve:i,reject:u,next:null};o?o=o.next=l:(n=o=l,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=0,u=1,l=3,s="http://www.w3.org/1999/xlink",a="http://www.w3.org/2000/svg",c={},f=[];function h(e,t){var n={};for(var o in e)n[o]=e[o];for(var r in t)n[r]=t[r];return n}function d(e){return!Array.isArray(e)&&"object"===(void 0===e?"undefined":t(e))}var p=function e(){n(this,e),this.message="Cannot insert Fragment tag directly into DOM.",this.toString=function(){return this.message}};function y(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}function m(e,t,n,o,r,i){return{type:e,props:t,children:n,element:o,key:r,flag:i}}function v(e,t){return m(e,c,f,t,null,l)}function g(e){return m(e.nodeName.toLowerCase(),c,f.map.call(e.childNodes,x),e,null,i)}function x(e){return 3===e.nodeType?v(e.nodeValue,e):g(e)}function b(e){return e.currentTarget.events[e.type](e)}function k(e){return null==e?null:e.key}function S(e,n,o,r,i){if("style"!==n||"object"!==(void 0===r?"undefined":t(r))||Array.isArray(r)){if("key"!==n)if("className"===n&&(n="class"),"o"===n[0]&&"n"===n[1])e.events||(e.events={}),e.events[n=n.slice(2).toLowerCase()]=r,null==r?e.removeEventListener(n,b):null==o&&e.addEventListener(n,b);else{var u=null==r||!1===r||"no"===r||"off"===r;n in e&&"list"!==n&&"type"!==n&&"draggable"!==n&&"spellcheck"!==n&&"translate"!==n&&!i?(e[n]=null==r?"":r,u&&e.removeAttribute(n)):"xlink-href"===n||"xlinkHref"===n?(e.setAttributeNS(s,"href",r),e.setAttribute("href",r)):u?e.removeAttribute(n):e.setAttribute(n,r)}}else for(var l in h(o,r)){var a=null==r||null==r[l]?"":r[l];"-"===l[0]?e[n].setProperty(l,a):e[n][l]=a}}function w(e,t,n){var o=void 0;o=e.flag===l?document.createTextNode(e.type):(n=n||"svg"===e.type)?document.createElementNS(a,e.type):document.createElement(e.type);var r=e.props;r.onmount&&t.push(function(){r.onmount(o)});for(var i=0,u=e.children.length;i<u;i++)o.appendChild(w(e.children[i],t,n));for(var s in r)S(o,s,null,r[s],n);return e.element=o}function M(e,t){function n(){e&&e.nodeType&&e.removeChild(function e(t){for(var n=0,o=t.children.length;n<o;n++)e(t.children[n]);return t.element}(t))}var o=t.props&&t.props.onunmount;null!=o?o(n,t.element):n()}function N(e,t,n,o,r,u){if(o===n);else if(null!=n&&n.flag===l&&o.flag===l)n.type!==o.type&&(t.nodeValue=o.type);else if(null==n||n.type!==o.type){var s=e.insertBefore(w(o,r,u),t);null!=n&&M(e,n),t=s}else{!function(e,t,n,o,r,i){for(var u in h(t,n))("value"===u||"checked"===u?e[u]:t[u])!==n[u]&&S(e,u,t[u],n[u],r);var l=i?n.onmount:n.onupdate;null!=l&&o.push(function(){l(e,t,n)})}(t,n.props,o.props,r,u=u||"svg"===o.type,n.flag===i);for(var a=void 0,c=void 0,f=void 0,d=n.children,p=0,y=d.length-1,m=void 0,v=o.children,g=0,x=v.length-1;g<=x&&p<=y&&(f=k(d[p]),m=k(v[g]),null!=f&&f===m);)N(t,d[p].element,d[p],v[g],r,u),p++,g++;for(;g<=x&&p<=y&&(f=k(d[y]),m=k(v[x]),null!=f&&f===m);)N(t,d[y].element,d[y],v[x],r,u),y--,x--;if(p>y)for(;g<=x;)t.insertBefore(w(v[g++],r,u),(c=d[p])&&c.element);else if(g>x)for(;p<=y;)M(t,d[p++]);else{for(var b=function(e,t,n){for(var o={},r=void 0,i=void 0;t<=n;t++)null!=(r=(i=e[t]).key)&&(o[r]=i);return o}(d,p,y),D={};g<=x;)f=k(c=d[p]),m=k(v[g]),D[f]||null!=m&&m===k(d[p+1])?(null==f&&M(t,c),p++):null==m||n.flag===i?(null==f&&(N(t,c&&c.element,c,v[g],r,u),g++),p++):(f===m?(N(t,c.element,c,v[g],r,u),D[m]=!0,p++):null!=(a=b[m])?(N(t,t.insertBefore(a.element,c&&c.element),a,v[g],r,u),D[m]=!0):N(t,c&&c.element,null,v[g],r,u),g++);for(;p<=y;)null==k(c=d[p++])&&M(t,c);for(var _ in b)null==D[_]&&M(t,b[_])}}return o.element=t,o}function D(e,t,n){"string"==typeof n&&(n=document.querySelector(n));var o=[];if(N(n,n.children[0],t,e,o),e!==t)for(;o.length>0;)o.pop()();return e}function _(e,t,n){"string"==typeof t&&(t=document.querySelector(t)),t||(t=document.body);var o=[];if(Array.isArray(e))throw new p;n?("string"==typeof n&&(n=document.querySelector(n)),D(e,g(n),t)):e=D(e,null,t);for(e.element.isMounted=!0;o.length>0;)o.pop()();return e}var O=(new Date).getTime().toString(16),U=function(){function e(t){n(this,e),t||(t={}),this.props=t,this.selector=t.container||"body",t.render&&(this.render=t.render),t.state&&(this.state=t.state),this.selector&&(this.container=document.querySelector(this.selector)),this.currentVNode=null,this.componentShouldUpdate=!0,this.isMounted=!1,this.element=null,this.hydrate=t.hydrate||null,t.componentWillMount&&(this.componentWillMount=t.componentWillMount),t.componentDidMount&&(this.componentDidMount=t.componentDidMount),t.componentWillUpdate&&(this.componentWillUpdate=t.componentWillUpdate),t.componentDidUpdate&&(this.componentDidUpdate=t.componentDidUpdate),t.componentWillUnmount&&(this.componentWillUnmount=t.componentWillUnmount)}return o(e,[{key:"noop",value:function(){}},{key:"componentWillMount",value:function(e){e&&"function"==typeof e&&e.call(e,this)}},{key:"componentDidMount",value:function(){this.noop()}},{key:"componentWillUpdate",value:function(e){e&&"function"==typeof e&&e.call(e,this)}},{key:"componentDidUpdate",value:function(){this.noop()}},{key:"componentWillUnmount",value:function(e){e&&"function"==typeof e&&e.call(e,this)}},{key:"render",value:function(e){return e}},{key:"setState",value:function(e){if("function"==typeof e){var t=void 0;t=d(this.state)?h(c,this.state):Array.isArray(this.state)?f.concat(f,this.state):this.state;var n=e.call(this,t);n&&(this.state=n)}else if(d(this.state)&&d(e)){var o=h(this.state,e);this.state=o}else this.state=e}},{key:"update",value:function(e){if(this.render&&(this.componentShouldUpdate||!this.isMounted)){var t=this.state;!0!==e&&e&&(t=e),this.container&&"string"==typeof this.container&&(this.selector=this.container,this.container=document.querySelector(this.container)),this.hydrate&&!this.isMounted&&("string"==typeof this.hydrate&&(this.hydrate=document.querySelector(this.hydrate)),this.currentVNode=g(this.hydrate));var n,o,r=this.render(t),i=this;if(!this.isMounted)return this.currentVNode?(this.oldVNode=r,this.currentVNode=D(r,this.currentVNode,this.container),this.element=this.currentVNode.element,this.isMounted=!0,this.componentDidMount()):this.componentWillMount(function(){i.oldVNode=r,i.currentVNode=_(r,i.container),i.element=i.currentVNode.element,i.isMounted=!0,i.componentDidMount()}),void(this.container&&1===this.container.nodeType||console.error("The container for this class component is not a valid DOM node. Check the selector provided for the class to make sure it is a valid CSS selector and that the container exists in the DOM. You might be targeting a nonexistent node."));if(n=r,o=this.oldVNode,JSON.stringify(n)!==JSON.stringify(o))this.componentWillUpdate(function(){i.oldVNode=i.render(t),i.currentVNode=D(r,i.currentVNode,i.container),i.element=i.currentVNode.element,i.isMounted=!0,i.componentDidUpdate()})}}},{key:"unmount",value:function(){if(this.element){var e=this;this.componentWillUnmount(function(){e.container.removeChild(e.element);for(var t in e)delete e[t];e.__proto__=null})}}},{key:"state",get:function(){return this[O]},set:function(e){var t=this;this[O]=e,setTimeout(function(){return t.update()},1e3/60)}}]),e}(),V=function(){function e(){n(this,e),this.events={}}return o(e,[{key:"watch",value:function(e,t){return this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t)}},{key:"dispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.events.hasOwnProperty(e)?this.events[e].map(function(e){return e(t)}):[]}}]),e}(),A=y(),W=function(){function e(t){n(this,e),this[A]=void 0,this.observer=new V,this.state=t.state}return o(e,[{key:"dispatch",value:function(e,t){this.observer.dispatch(e,t)}},{key:"watch",value:function(e,t){this.observer.watch(e,t)}},{key:"setState",value:function(e){if("function"==typeof e){var t;t=h(c,this.state);var n=e.call(this,t);n&&(this.state=n)}else if(d(this.state)&&d(e)){var o=h(this.state,e);this.state=o}}},{key:"state",get:function(){return this[A]},set:function(e){this[A]=e,this.dispatch("dataStoreStateChanged",this.state)}}]),e}(),C=function(e){function t(e){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.dataStore=e.dataStore,e.dataStore instanceof W&&e.dataStore.watch("dataStoreStateChanged",function(){return o.update(o.dataStore.state)}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,U),t}();e.h=function(e,n){for(var o=void 0,r=[],i=[],l=arguments.length,s=Array(l>2?l-2:0),a=2;a<l;a++)s[a-2]=arguments[a];for(var c=s.length,f=(n=n||{}).key;c-- >0;)r.push(s[c]);for(null!=n.children&&(r.length<=0&&r.push(n.children),delete n.children);r.length>0;)if(Array.isArray(o=r.pop()))for(c=o.length;c-- >0;)r.push(o[c]);else!1===o||!0===o||null==o||i.push("object"===(void 0===o?"undefined":t(o))?o:v(o));return delete n.key,"function"==typeof e?e(n,n.children=i):m(e,n,i,null,f,u)},e.mount=_,e.unmount=function(e){function t(){e.element.parentNode.removeChild(e.element),e.element=null}e.props.onunmount?e.props.onunmount(t,e.element):t()},e.render=function(e,t,n){return D(e,t,n)},e.Component=U,e.Fragment=function(e,t){return t},e.DataStore=W,e.DataStoreComponent=C,e.Observer=V,e.uuid=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=composi.js.map
