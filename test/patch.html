<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link href="https://unpkg.com/mocha@4.0.1/mocha.css" rel="stylesheet" />
  <link rel="stylesheet" href="/test/styles.css">
</head>
<body>
  <nav onclick="location.pathname='/test/index.html'">
    <h1>Mocha Tests - Composi patch Function</h1>
  </nav>
  <section>
    <div id="mocha"></p></div>
    <div id="messages"></div>
    <div id="fixtures"></div>
    <div id="hide-tests">
      <div id="list-test"></div>
    </div>
  </section>
  
  <script src="https://unpkg.com/mocha@4.0.1/mocha.js"></script>
  <script src="https://unpkg.com/chai@4.1.2/chai.js"></script>
  <script src='/dist/composi.js'></script>
  <script>mocha.setup('bdd')</script>
  <script>
    const {h, render, patch} = composi
    let expect = chai.expect

    const listItems = ['one', 'two', 'three']

    function List(items) {
      return h(
        'ul',
        {
          class: 'list'
        },
        items.map(item => h('li', null, item))
      )
    }
    const list = List(listItems)

    let oldNode
    let element
    element = patch(oldNode, (oldNode = list), element, document.querySelector('#list-test'))

    
    describe('Initial Render of List', function() {

      const listEl = document.querySelector('#list-test ul')

      it('list should be of type "UL"', function() {
        expect(listEl.nodeName).to.equal('UL')
      })
      it('list should have class of "list"', function() {
        expect(listEl.className).to.equal('list')
      })
      it('list should have three children', function() {
        expect(listEl.childNodes).to.have.lengthOf(3)
      })
      it('list item one should be type "LI"', function() {
        expect(listEl.childNodes[0].nodeName).to.equal('LI')
      })
      it('list 1 item content should be "one"', function() {
        expect(listEl.childNodes[0].textContent).to.equal('one')
      })
      it('list 2 item content should be "two"', function() {
        expect(listEl.childNodes[1].textContent).to.equal('two')
      })
      it('list 3 item content should be "three"', function() {
        expect(listEl.childNodes[2].textContent).to.equal('three')
      })
      // mocha.run()
    });

    
    describe('Update Content of List to Uppercase', function() {
      it('list 1 item content should be "ONE"', function(done) {
        setTimeout(function() {
          let listEl
          listItems[0] = 'ONE'
          const list = List(listItems)
          element = patch(oldNode, (oldNode = list), element, document.querySelector('#list-test'))
          listEl = document.querySelector('#list-test ul')
          expect(listEl.childNodes[0].textContent).to.equal('ONE')
        }, 1000)
        done()
      })
      it('list 2 item content should be "TWO"', function(done) {
        setTimeout(function() {
          let listEl
          listItems[1] = 'TWO'
          const list = List(listItems)
          element = patch(oldNode, (oldNode = list), element, document.querySelector('#list-test'))
          listEl = document.querySelector('#list-test ul')
          expect(listEl.childNodes[1].textContent).to.equal('TWO')
        }, 1000)
        done()
      })
      it('list 3 item content should be "THREE"', function(done) {
        setTimeout(function() {
          let listEl
          listItems[2] = 'THREE'
          const list = List(listItems)
          element = patch(oldNode, (oldNode = list), element, document.querySelector('#list-test'))
          listEl = document.querySelector('#list-test ul')
          expect(listEl.childNodes[2].textContent).to.equal('THREE')
        }, 1000)
        done()
      })
    })

    
    describe('Add One Item to List', function() {
      it('List should have 4 items', function(done) {
        setTimeout(function() {
          let listEl
          listItems.push('four')
          const list = List(listItems)
          element = patch(oldNode, (oldNode = list), element, document.querySelector('#list-test'))
          listEl = document.querySelector('#list-test ul')
          expect(listEl.children).to.have.lengthOf(4)
        }, 1000)
        done()
      });
      it('Fourth List Item Should be "four"', function(done) {
        setTimeout(function() {
          let listEl
          listEl = document.querySelector('#list-test ul')
          expect(listEl.childNodes[3].textContent).to.equal('four')
        }, 1000)
        done()
      })
    })

  
    describe('Check Class of List', function() {
      it('List should have class of "list"', function() {
        let listEl = document.querySelector('#list-test ul')
        expect(listEl.className).to.equal('list')
      });
      it('Patched List should have class of "new-list"', function(done) {
        let listEl = document.querySelector('#list-test ul')
        setTimeout(function() {
          function List(items) {
            return h(
              'ul',
              {
                class: 'new-list'
              },
              listItems.map(item => h('li', null, item))
            )
          }
          const list = List(listItems)
          element = patch(oldNode, (oldNode = list), element, document.querySelector('#list-test'))
          listEl = document.querySelector('#list-test ul')
          expect(listEl.className).to.equal('new-list')
        }, 1000)
        done()
      });
    })

    
    describe('Patch List to Have Two Items: "apples" and "oranges"', function() {
      it('List should have two children', function(done) {
        let listEl = document.querySelector('#list-test ul')

        function List(items) {
          return h(
            'ul',
            {
              class: false
            },
            items.map(item => h('li', null, item))
          )
        }
        setTimeout(function() {
          const list = List(['apples','oranges'])
          element = patch(oldNode, (oldNode = list), element, document.querySelector('#list-test'))
          listEl = document.querySelector('#list-test ul')
          expect(listEl.children).to.have.lengthOf(2)
        }, 1000)
        done()
      });

      it('First List Item should be "apples"', function(done) {
        setTimeout(function() {
          let listEl = document.querySelector('#list-test ul')
          expect(listEl.children[0].textContent).to.equal('apples')
        }, 1000)
        done()
      })

      it('Second List Item should be "oranges"', function(done) {
        setTimeout(function() {
          let listEl = document.querySelector('#list-test ul')
          expect(listEl.children[1].textContent).to.equal('oranges')
        }, 1000)
        done()
      })

      it('List should have no class because value was set to false', function(done) {
        setTimeout(function() {
          let listEl = document.querySelector('#list-test ul')
          expect(listEl.className).to.equal('')
        }, 1000)
        done()
      })
    })


    mocha.run()


  </script>
</body>
</html>